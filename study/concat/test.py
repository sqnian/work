import torch
import os
import numpy as np 
os.environ['CUDA_VISIBLE_DEVICES']="6"
import concat_test 


def  test():
    print('hello, run here \n')
    input = torch.randn([1,196,384],dtype=torch.float16).cuda()
    num = np.array([
    [
        [
            -0.1857563853263855,
            -0.09338372200727463,
            -0.15282246470451355,
            -0.22886328399181366,
            0.427108496427536,
            -0.5178837180137634,
            0.05062445253133774,
            -0.3292059004306793,
            -0.045971594750881195,
            -0.2185365855693817,
            -0.13578733801841736,
            -0.13902635872364044,
            0.03221087530255318,
            -0.47653523087501526,
            0.016927381977438927,
            -0.22865425050258636,
            -0.2521772086620331,
            -0.25539708137512207,
            -0.32675114274024963,
            0.013261407613754272,
            -7.930074214935303,
            0.189126655459404,
            -0.3898487091064453,
            -0.030220789834856987,
            -0.07747548073530197,
            -0.004000355489552021,
            -0.23102492094039917,
            0.06937935948371887,
            -0.30691584944725037,
            -0.06736376881599426,
            -0.3970196843147278,
            -0.32153502106666565,
            -0.05433781445026398,
            -0.3327123820781708,
            0.05672609433531761,
            -0.08761601895093918,
            0.37370842695236206,
            0.04509398713707924,
            -0.08437415212392807,
            -0.1751200556755066,
            -0.14927129447460175,
            0.10652294754981995,
            -0.23416903614997864,
            -0.3594743013381958,
            -0.34740039706230164,
            -0.08375746011734009,
            -0.03606473654508591,
            0.16245204210281372,
            0.00972746405750513,
            -0.21482452750205994,
            -0.39085790514945984,
            -0.43379488587379456,
            -0.5216049551963806,
            0.2329791784286499,
            -0.2837592363357544,
            -0.13967813551425934,
            -0.40014028549194336,
            -0.09725609421730042,
            -0.359780490398407,
            -0.2187713235616684,
            -0.011740919202566147,
            -0.16010139882564545,
            -0.6356184482574463,
            -0.07375413179397583,
            -0.27923333644866943,
            -0.06690075248479843,
            -0.1221425011754036,
            -0.22885441780090332,
            -0.04193009063601494,
            0.0758223906159401,
            -0.11089279502630234,
            -0.2484169602394104,
            -0.2818368375301361,
            -0.44254070520401,
            -0.12268483638763428,
            -0.08662287890911102,
            0.08183057606220245,
            -0.005845228210091591,
            -0.16154231131076813,
            -0.3409382104873657,
            0.05352238193154335,
            -0.40858811140060425,
            -0.4568991959095001,
            -0.6967212557792664,
            -0.21270719170570374,
            -0.11020435392856598,
            -0.40290895104408264,
            -0.18498773872852325,
            -0.2906724810600281,
            -0.2767446041107178,
            -0.3863949775695801,
            -0.5953800082206726,
            -0.23490391671657562,
            0.14500345289707184,
            -0.22143125534057617,
            -0.20733970403671265,
            -0.07770013809204102,
            0.08539628237485886,
            -0.12414471060037613,
            -0.21000100672245026,
            -0.4341397285461426,
            -0.47670188546180725,
            -0.49573495984077454,
            -0.28958502411842346,
            0.02143736183643341,
            -0.6877794861793518,
            -0.19316482543945312,
            -0.5879284143447876,
            -0.0059590390883386135,
            -0.17090576887130737,
            -0.052802473306655884,
            -0.3261171281337738,
            -0.11255644261837006,
            0.0646004006266594,
            -5.096870422363281,
            0.09539543092250824,
            -0.42547503113746643,
            -0.05993175879120827,
            -0.3641431927680969,
            -0.17431172728538513,
            -0.2771669030189514,
            -0.17791932821273804,
            -0.16621731221675873,
            -0.4124445915222168,
            -0.3244847357273102,
            -0.23840297758579254,
            0.056096918880939484,
            -0.11096958070993423,
            0.013002500869333744,
            -0.06315093487501144,
            -0.16718105971813202,
            -0.22005878388881683,
            -0.20480677485466003,
            -0.22965580224990845,
            -0.002733847824856639,
            0.11011908203363419,
            -0.20671133697032928,
            0.05910665541887283,
            -0.022896166890859604,
            -0.056884147226810455,
            -0.38081568479537964,
            -0.24676597118377686,
            0.10283586382865906,
            -0.17767049372196198,
            -0.25350698828697205,
            -0.3507152199745178,
            -0.3701489567756653,
            -0.39008939266204834,
            -0.404103547334671,
            -0.01935890130698681,
            -0.23031899333000183,
            -0.5359627604484558,
            -0.17692792415618896,
            -0.33987680077552795,
            -0.19200187921524048,
            -0.4396911561489105,
            -0.23114407062530518,
            -0.32778018712997437,
            -0.18790823221206665,
            -0.5327868461608887,
            -0.07365751266479492,
            -0.08499465137720108,
            0.13085238635540009,
            -0.49581000208854675,
            -0.745842456817627,
            -0.4016405940055847,
            0.35143306851387024,
            -0.40516889095306396,
            0.29545456171035767,
            -0.4966837167739868,
            0.33299124240875244,
            -0.5655737519264221,
            0.4628414511680603,
            -0.5240945219993591,
            -0.13083896040916443,
            -0.3364381790161133,
            0.19810807704925537,
            -0.322282075881958,
            0.574515700340271,
            -0.5402384996414185,
            0.32526081800460815,
            -0.5816019773483276,
            0.17046038806438446,
            -0.13806258141994476,
            0.34463122487068176,
            -0.42640042304992676,
            0.10461294651031494,
            -0.12187345325946808,
            0.6445603966712952,
            -0.3103567063808441,
            0.545401930809021,
            -0.3089607357978821,
            0.7667475342750549,
            -0.24866801500320435,
            0.17980189621448517,
            -0.3144586682319641,
            0.46226954460144043,
            -0.31253761053085327,
            0.46464118361473083,
            -0.06300793588161469,
            0.33838126063346863,
            -0.02097463048994541,
            0.2896648943424225,
            0.3043288588523865,
            0.05956859141588211,
            0.20123791694641113,
            0.16094452142715454,
            0.44969502091407776,
            0.13196274638175964,
            0.07094909995794296,
            0.47354695200920105,
            0.617343544960022,
            0.45491546392440796,
            0.1462431252002716,
            0.44124698638916016,
            0.8289483189582825,
            0.6639344692230225,
            0.4705432057380676,
            0.07139173150062561,
            0.08536208420991898,
            0.1294964998960495,
            0.2865126430988312,
            0.38898223638534546,
            0.1810106784105301,
            0.26862892508506775,
            0.10008682310581207,
            -0.032623983919620514,
            0.2975159287452698,
            0.3528316020965576,
            0.04197726026177406,
            -0.19856035709381104,
            0.42039188742637634,
            0.21450543403625488,
            0.367191344499588,
            0.18545037508010864,
            0.30134275555610657,
            0.20052354037761688,
            0.2160039246082306,
            -0.06970421224832535,
            0.47678685188293457,
            0.11711104959249496,
            0.3265741169452667,
            0.013106836006045341,
            0.7392930388450623,
            -0.025232549756765366,
            0.5890405178070068,
            0.26120907068252563,
            0.5049055814743042,
            0.26876911520957947,
            0.2995784282684326,
            0.16713446378707886,
            0.5506706237792969,
            -0.007144789211452007,
            0.21703609824180603,
            0.1789899319410324,
            0.22539208829402924,
            0.21106605231761932,
            0.17974762618541718,
            -0.1438104510307312,
            0.26833516359329224,
            0.11271233856678009,
            0.2830424904823303,
            0.27856090664863586,
            0.2633625268936157,
            0.065126433968544,
            0.3763348460197449,
            -0.3972216248512268,
            0.6291665434837341,
            0.06955044716596603,
            0.03465282917022705,
            0.27002593874931335,
            0.5029805898666382,
            0.08462170511484146,
            0.19509094953536987,
            0.09860002249479294,
            0.07353699952363968,
            -0.0581868551671505,
            0.5051096677780151,
            0.10025715082883835,
            0.4785947799682617,
            0.22863978147506714,
            0.1942855417728424,
            -0.026611192151904106,
            0.425008088350296,
            0.11201529204845428,
            0.4503692388534546,
            0.1853533238172531,
            0.863636314868927,
            0.1307782232761383,
            0.3497309386730194,
            -0.23033007979393005,
            0.47844573855400085,
            0.09736929088830948,
            0.3386736214160919,
            0.42064085602760315,
            0.021896177902817726,
            0.026188960298895836,
            0.18841348588466644,
            0.08002327382564545,
            0.5893123745918274,
            0.12759095430374146,
            0.43031272292137146,
            -0.09918269515037537,
            0.3014102876186371,
            -0.07212553918361664,
            0.44639015197753906,
            0.2530120611190796,
            0.4329093098640442,
            0.10197079181671143,
            0.45179492235183716,
            -0.23806142807006836,
            0.31202375888824463,
            -0.31913548707962036,
            0.08488384634256363,
            0.02901998907327652,
            5.1326375007629395,
            -0.09092745184898376,
            0.3824634253978729,
            -0.22270019352436066,
            0.38480105996131897,
            -0.5702527761459351,
            0.36255159974098206,
            0.015402743592858315,
            0.6864531636238098,
            -0.09782234579324722,
            0.7785525321960449,
            -0.45927315950393677,
            0.22572429478168488,
            -0.14806538820266724,
            0.39470168948173523,
            0.02959105558693409,
            0.3628365099430084,
            0.09512299299240112,
            0.2052566409111023,
            -0.2108599841594696,
            0.32894545793533325,
            0.18904586136341095,
            0.511854887008667,
            -0.1331714242696762,
            0.15345773100852966,
            0.028818197548389435,
            0.3202034533023834,
            0.08093484491109848,
            0.37194547057151794,
            -0.22953511774539948,
            0.9511783719062805,
            -0.26056623458862305,
            0.17385238409042358,
            -0.1991899460554123,
            0.46945881843566895,
            0.14841338992118835,
            0.2144625037908554,
            0.15570607781410217,
            0.6299954056739807,
            0.07186581194400787,
            0.2483671009540558,
            -0.264430433511734,
            0.6126914620399475,
            -0.03976849839091301,
            0.1822238266468048,
            0.0222418662160635,
            0.34367215633392334,
            -0.1613992303609848,
            1.0894187688827515,
            -0.22273685038089752,
            -0.5084812641143799,
            -0.10540403425693512,
            0.9105337262153625,
            0.0808989629149437,
            0.15636934340000153,
            -0.24929441511631012,
            0.27750492095947266,
            -0.22971603274345398,
            0.7816678285598755,
            -0.08594224601984024,
            0.36459243297576904,
            -0.6066946983337402,
            0.5700446963310242,
            -0.2939309775829315,
            0.44798702001571655,
            0.20538853108882904,
            0.4064616858959198,
            0.09855997562408447,
            0.735469400882721
        ]
    ]
])
    input_ = torch.tensor(num.astype(np.float16)).cuda()
    print('input shape: ', input.shape)
    print('input_ shape: ', input_.shape)

    output = torch.cat((input, input_),dim=1)

    out_test = concat_test.test_concat(input, input_)
    diff_test = torch.abs(output.flatten() - out_test.flatten())
    print('diff test max: ',diff_test.max())
    print('output shape:',output.shape)
    print('out_test shape:',out_test.shape)
    print('output shape: ', output.shape)



if __name__ == '__main__':
    torch.manual_seed(11)
    torch.cuda.manual_seed_all(122)
    test()